<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard StarnetðŸ’«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Font & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* === Layout Umum === */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      color: #333;
    }
    header {
      background: #1a237e;
      color: #fff;
      padding: 15px;
      font-size: 22px;
      font-weight: bold;
      text-align: center;
    }
    .container {
      display: flex;
    }
    /* === Sidebar === */
    .sidebar {
      width: 220px;
      background: #1a237e;
      color: white;
      min-height: 100vh;
      padding-top: 20px;
      transition: width 0.3s;
    }
    .sidebar.shrink { width: 60px; }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 18px;
    }
    .sidebar ul { list-style: none; padding: 0; }
    .sidebar ul li {
      padding: 12px 20px;
      cursor: pointer;
      display: flex; align-items: center;
    }
    .sidebar ul li:hover { background: #3949ab; }
    .sidebar ul li i { margin-right: 10px; }
    .content {
      flex: 1;
      padding: 20px;
    }
    h3 { margin-top: 30px; color: #1a237e; }
    /* === Form & Table === */
    form {
      margin: 15px 0;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    input, select, button {
      margin: 5px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #1a237e;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #3949ab; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    table th, table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    table th { background: #3949ab; color: #fff; }
    .info-box {
      font-weight: bold;
      margin: 10px 0;
      background: #e8eaf6;
      padding: 10px;
      border-radius: 6px;
    }
  </style>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
</head>
<body>
  <header>Dashboard StarnetðŸ’«</header>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <h2><i class="fas fa-satellite-dish"></i> Starnet</h2>
      <ul>
        <li><i class="fas fa-users"></i> User</li>
        <li><i class="fas fa-box"></i> Paket</li>
        <li><i class="fas fa-file-invoice-dollar"></i> Billing</li>
        <li><i class="fas fa-money-bill-wave"></i> Kas</li>
        <li><i class="fas fa-exclamation-triangle"></i> Gangguan</li>
        <li><i class="fas fa-chart-line"></i> Grafik ISP</li>
        <li><i class="fas fa-user-cog"></i> Teknisi</li>
        <li><i class="fas fa-tools"></i> Material</li>
        <li><i class="fas fa-pen"></i> Edit Nama ISP</li>
      </ul>
    </div>

    <!-- Content -->
    <div class="content">
      <!-- Tambah User -->
      <form id="userForm">
        <input type="text" id="name" placeholder="Nama" required>
        <input type="text" id="username" placeholder="Username" required>
        <input type="text" id="planName" placeholder="Paket" required>
        <input type="text" id="contact" placeholder="Kontak">
        <button type="submit">Tambah User</button>
      </form>
      <h3>Daftar User</h3>
      <table>
        <thead>
          <tr>
            <th>Nama</th><th>Username</th><th>Paket</th><th>Kontak</th><th>Status</th><th>Tunggakan</th>
          </tr>
        </thead>
        <tbody id="userTableBody"></tbody>
      </table>
      <div class="info-box" id="totalTunggakan">Total Tunggakan: Rp 0</div>

      <!-- Kas Perusahaan -->
      <h3>Kas Perusahaan</h3>
      <form id="kasForm">
        <select id="kasType">
          <option value="Masuk">Kas Masuk</option>
          <option value="Keluar">Kas Keluar</option>
        </select>
        <input type="number" id="kasNominal" placeholder="Nominal" required>
        <input type="text" id="kasKeterangan" placeholder="Keterangan">
        <button type="submit">Simpan</button>
      </form>
      <table>
        <thead>
          <tr><th>Jenis</th><th>Nominal</th><th>Keterangan</th><th>Waktu</th></tr>
        </thead>
        <tbody id="kasTableBody"></tbody>
      </table>
      <div class="info-box" id="kasSaldo">Saldo Kas: Rp 0</div>

      <!-- Grafik ISP -->
      <h3>Grafik ISP</h3>
      <canvas id="ispChart"></canvas>
    </div>
  </div>

  <script>
    // === Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyB-iBpZNC0YZBTAUzir7gJuU9kBQg82moc",
      authDomain: "dnt-network-7.firebaseapp.com",
      projectId: "dnt-network-7",
      storageBucket: "dnt-network-7.firebasestorage.app",
      messagingSenderId: "761179668371",
      appId: "1:761179668371:web:7d1468d0298041d4783266",
      measurementId: "G-CD3EQ350R4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // === User ===
    const userForm = document.getElementById('userForm');
    const userTableBody = document.getElementById('userTableBody');

    userForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const username = document.getElementById('username').value;
      const planName = document.getElementById('planName').value;
      const contact = document.getElementById('contact').value;

      await db.collection('customers').add({
        name, username, planName, contact,
        status: "Aktif", tunggakan: 0,
        lastSeen: new Date()
      });
      userForm.reset();
      loadUsers();
    });

    async function loadUsers() {
      const snapshot = await db.collection('customers').get();
      userTableBody.innerHTML = '';
      let totalTunggakan = 0;
      snapshot.forEach(doc => {
        const data = doc.data();
        userTableBody.innerHTML += `
          <tr>
            <td>${data.name}</td>
            <td>${data.username}</td>
            <td>${data.planName}</td>
            <td>${data.contact}</td>
            <td>${data.status}</td>
            <td>${data.tunggakan || 0}</td>
          </tr>`;
        totalTunggakan += data.tunggakan || 0;
      });
      document.getElementById('totalTunggakan').innerText = "Total Tunggakan: Rp " + totalTunggakan;
    }

    // === Kas ===
    const kasForm = document.getElementById('kasForm');
    const kasTableBody = document.getElementById('kasTableBody');
    let saldoKas = 0;

    kasForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const type = document.getElementById('kasType').value;
      const nominal = parseInt(document.getElementById('kasNominal').value);
      const keterangan = document.getElementById('kasKeterangan').value;
      const waktu = new Date().toLocaleString();

      await db.collection('kas').add({type, nominal, keterangan, waktu});
      kasForm.reset();
      loadKas();
    });

    async function loadKas() {
      const snapshot = await db.collection('kas').get();
      kasTableBody.innerHTML = '';
      saldoKas = 0;
      snapshot.forEach(doc => {
        const data = doc.data();
        kasTableBody.innerHTML += `
          <tr>
            <td>${data.type}</td>
            <td>${data.nominal}</td>
            <td>${data.keterangan}</td>
            <td>${data.waktu}</td>
          </tr>`;
        if (data.type === "Masuk") saldoKas += data.nominal;
        else saldoKas -= data.nominal;
      });
      document.getElementById('kasSaldo').innerText = "Saldo Kas: Rp " + saldoKas;
    }

    // === Grafik ISP Dummy ===
    const ctx = document.getElementById('ispChart').getContext('2d');
    const ispChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          { label: 'Upload', borderColor: 'blue', data: [] },
          { label: 'Download', borderColor: 'green', data: [] },
          { label: 'Load Balance', borderColor: 'orange', data: [] }
        ]
      },
      options: { responsive: true }
    });

    function updateISP() {
      const now = new Date().toLocaleTimeString();
      ispChart.data.labels.push(now);
      ispChart.data.datasets[0].data.push(Math.floor(Math.random()*100));
      ispChart.data.datasets[1].data.push(Math.floor(Math.random()*100));
      ispChart.data.datasets[2].data.push(Math.floor(Math.random()*100));
      ispChart.update();
    }
    setInterval(updateISP, 5000);

    // === Auto Cek User Offline 15 menit ===
    setInterval(async () => {
      const snapshot = await db.collection('customers').get();
      snapshot.forEach(async doc => {
        const data = doc.data();
        if (data.lastSeen) {
          const diff = (new Date() - data.lastSeen.toDate()) / 60000;
          if (diff > 15 && data.status !== "Gangguan") {
            await db.collection('customers').doc(doc.id).update({status: "Gangguan"});
          }
        }
      });
      loadUsers();
    }, 60000);

    // === Load Data Awal ===
    loadUsers();
    loadKas();
  </script>
</body>
</html>
