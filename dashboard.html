<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Starnet ğŸ’« Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background-color: #f4f6f9; }
    .sidebar {
      height: 100vh;
      background: linear-gradient(180deg, #0d6efd, #0a58ca);
      color: white;
      padding-top: 20px;
      position: fixed;
      width: 240px;
    }
    .sidebar a {
      display: block;
      color: white;
      padding: 12px 20px;
      margin: 5px 10px;
      border-radius: 10px;
      text-decoration: none;
    }
    .sidebar a:hover { background: rgba(255,255,255,0.2); }
    .content { margin-left: 250px; padding: 20px; }
    .card { border-radius: 15px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h4 class="text-center mb-4">ğŸ’« Starnet</h4>
    <a href="#" onclick="showPage('dashboard')"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="#" onclick="showPage('user')"><i class="bi bi-people"></i> User</a>
    <a href="#" onclick="showPage('paket')"><i class="bi bi-box"></i> Paket</a>
    <a href="#" onclick="showPage('billing')"><i class="bi bi-credit-card"></i> Billing</a>
    <a href="#" onclick="showPage('kas')"><i class="bi bi-bank"></i> Kas Perusahaan</a>
    <a href="#" onclick="showPage('teknisi')"><i class="bi bi-person-badge"></i> Teknisi</a>
    <a href="#" onclick="showPage('gangguan')"><i class="bi bi-exclamation-triangle"></i> Gangguan</a>
    <a href="#" onclick="showPage('material')"><i class="bi bi-archive"></i> Material</a>
    <a href="#" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a>
  </div>

  <!-- Content -->
  <div class="content">
    <div id="dashboard">
      <h2>ğŸ“Š Dashboard Utama</h2>
      <div class="row mb-4">
        <div class="col-md-3"><div class="card shadow p-3 text-center"><h5>ğŸ‘¥ Total User</h5><p id="totalUser" class="fs-3 fw-bold text-primary">0</p></div></div>
        <div class="col-md-3"><div class="card shadow p-3 text-center"><h5>ğŸ’° Pendapatan</h5><p id="totalPendapatan" class="fs-3 fw-bold text-success">Rp 0</p></div></div>
        <div class="col-md-3"><div class="card shadow p-3 text-center"><h5>âš ï¸ Tunggakan</h5><p id="totalTunggakan" class="fs-3 fw-bold text-danger">Rp 0</p></div></div>
        <div class="col-md-3"><div class="card shadow p-3 text-center"><h5>ğŸ¦ Kas</h5><p id="totalKas" class="fs-3 fw-bold text-info">Rp 0</p></div></div>
      </div>
    </div>

    <!-- User Management -->
    <div id="user" class="hidden">
      <h3>ğŸ“‹ User Management</h3>
      <button class="btn btn-primary mb-2" onclick="addUser()">+ Tambah User</button>
      <table class="table table-striped shadow">
        <thead class="table-primary"><tr><th>Nama</th><th>Username</th><th>Paket</th><th>Status</th><th>Aksi</th></tr></thead>
        <tbody id="userTable"></tbody>
      </table>
    </div>

    <!-- Billing -->
    <div id="billing" class="hidden">
      <h3>ğŸ’³ Billing</h3>
      <table class="table table-striped shadow">
        <thead class="table-warning"><tr><th>ID</th><th>Nama</th><th>Paket</th><th>Periode</th><th>Status</th></tr></thead>
        <tbody id="billingTable"></tbody>
      </table>
    </div>

    <!-- Kas Perusahaan -->
    <div id="kas" class="hidden">
      <h3>ğŸ¦ Kas Perusahaan</h3>
      <button class="btn btn-success mb-2" onclick="addKas()">+ Tambah Transaksi</button>
      <table class="table table-striped shadow">
        <thead class="table-success"><tr><th>Tanggal</th><th>Keterangan</th><th>Jenis</th><th>Jumlah</th></tr></thead>
        <tbody id="kasTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    // Firebase Config Starnet ğŸ’«
    const firebaseConfig = {
      apiKey: "AIzaSyB-iBpZNC0YZBTAUzir7gJuU9kBQg82moc",
      authDomain: "dnt-network-7.firebaseapp.com",
      projectId: "dnt-network-7",
      storageBucket: "dnt-network-7.firebasestorage.app",
      messagingSenderId: "761179668371",
      appId: "1:761179668371:web:7d1468d0298041d4783266",
      measurementId: "G-CD3EQ350R4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Logout
    document.getElementById("logoutBtn").addEventListener("click", () => {
      auth.signOut().then(() => window.location.href = "index.html");
    });

    // Page Navigation
    function showPage(page) {
      document.querySelectorAll('.content > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(page).classList.remove('hidden');
    }

    // CRUD User (contoh read)
    function loadUsers() {
      db.collection("users").onSnapshot(snapshot => {
        let html = "";
        document.getElementById("totalUser").innerText = snapshot.size;
        snapshot.forEach(doc => {
          let u = doc.data();
          html += `<tr>
            <td>${u.nama}</td>
            <td>${u.username}</td>
            <td>${u.paket}</td>
            <td><span class="badge ${u.status=='Aktif'?'bg-success':'bg-danger'}">${u.status}</span></td>
            <td><button class="btn btn-sm btn-warning">Edit</button></td>
          </tr>`;
        });
        document.getElementById("userTable").innerHTML = html;
      });
    }

    // Billing
    function loadBilling() {
      db.collection("billing").onSnapshot(snapshot => {
        let html = ""; let tunggakan=0; let pendapatan=0;
        snapshot.forEach(doc => {
          let b = doc.data();
          html += `<tr>
            <td>${doc.id}</td>
            <td>${b.nama}</td>
            <td>${b.paket}</td>
            <td>${b.periode}</td>
            <td><span class="badge ${b.status=='Lunas'?'bg-success':'bg-danger'}">${b.status}</span></td>
          </tr>`;
          if(b.status=="Lunas") pendapatan+=b.jumlah; else tunggakan+=b.jumlah;
        });
        document.getElementById("billingTable").innerHTML = html;
        document.getElementById("totalPendapatan").innerText = "Rp " + pendapatan.toLocaleString();
        document.getElementById("totalTunggakan").innerText = "Rp " + tunggakan.toLocaleString();
      });
    }

    // Kas
    function loadKas() {
      db.collection("kas").onSnapshot(snapshot => {
        let html = ""; let totalKas=0;
        snapshot.forEach(doc => {
          let k = doc.data();
          html += `<tr>
            <td>${k.tanggal}</td>
            <td>${k.keterangan}</td>
            <td>${k.jenis}</td>
            <td>Rp ${k.jumlah.toLocaleString()}</td>
          </tr>`;
          totalKas += (k.jenis=="Masuk" ? k.jumlah : -k.jumlah);
        });
        document.getElementById("kasTable").innerHTML = html;
        document.getElementById("totalKas").innerText = "Rp " + totalKas.toLocaleString();
      });
    }

    // Load Data
    auth.onAuthStateChanged(user => {
      if (user) {
        loadUsers();
        loadBilling();
        loadKas();
      } else {
        window.location.href = "index.html";
      }
    });
  </script>
</body>
</html>
