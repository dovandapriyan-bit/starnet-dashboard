<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Starnet ðŸ’« Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body {margin:0; font-family:'Segoe UI',Arial,sans-serif; background:#f4f6fa; color:#333;}
    .sidebar {width:240px; height:100%; position:fixed; top:0; left:0; background:#1e293b; color:#fff; padding-top:20px; transition:0.3s;}
    .sidebar h2 {text-align:center; margin:0 0 30px; font-size:20px; color:#38bdf8;}
    .sidebar a {display:block; color:#cbd5e1; padding:12px 20px; text-decoration:none; transition:0.2s; font-size:15px;}
    .sidebar a:hover, .sidebar a.active {background:#334155; color:#fff;}
    .main {margin-left:240px; padding:25px; transition:0.3s;}
    .card {background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); margin-bottom:20px;}
    table {width:100%; border-collapse:collapse; font-size:14px;}
    th,td {padding:10px; border-bottom:1px solid #e2e8f0; text-align:left;}
    th {background:#f1f5f9;}
    #toggleBtn {position:fixed; top:10px; left:10px; background:#1e293b; color:#fff; border:none; padding:8px 12px; border-radius:6px; z-index:1000; display:none;}
    @media(max-width:768px){.sidebar{left:-240px;} .sidebar.active{left:0;} .main{margin-left:0;} #toggleBtn{display:block;}}
    button {padding:6px 12px; border:none; border-radius:6px; cursor:pointer;}
    button.primary {background:#3b82f6; color:white;}
  </style>
</head>
<body>
  <button id="toggleBtn">â˜°</button>
  <div class="sidebar" id="sidebar">
    <h2 id="ispName">Starnet ðŸ’«</h2>
    <a href="#" class="active" onclick="showSection('dashboard',this)">ðŸ“Š Dashboard</a>
    <a href="#" onclick="showSection('user',this)">ðŸ‘¥ User</a>
    <a href="#" onclick="showSection('paket',this)">ðŸ“¦ Paket</a>
    <a href="#" onclick="showSection('billing',this)">ðŸ’³ Billing</a>
    <a href="#" onclick="showSection('kas',this)">ðŸ’° Kas</a>
    <a href="#" onclick="logout()">ðŸšª Logout</a>
  </div>

  <div class="main">
    <!-- Dashboard -->
    <div id="dashboard" class="section">
      <h2>Dashboard</h2>
      <div class="card"><span>Total User: <b id="totalUser">0</b></span></div>
      <div class="card"><span>Saldo Kas: <b id="saldoKas">0</b></span></div>
    </div>

    <!-- User -->
    <div id="user" class="section" style="display:none;">
      <h2>User</h2>
      <form id="userForm">
        <input type="hidden" id="userId">
        <label>Nama</label><input id="userName" required>
        <label>Paket</label><select id="planName" required></select>
        <label>Status Bayar</label><select id="statusBayar"><option>Lunas</option><option>Belum</option></select>
        <button class="primary" type="submit">Simpan</button>
      </form>
      <div class="card"><table id="userTable"><thead><tr><th>Nama</th><th>Paket</th><th>Status</th><th>Aksi</th></tr></thead><tbody></tbody></table></div>
    </div>

    <!-- Paket -->
    <div id="paket" class="section" style="display:none;">
      <h2>Paket</h2>
      <form id="paketForm">
        <input type="hidden" id="paketId">
        <label>Nama Paket</label><input id="namaPaket" required>
        <label>Bandwidth</label><input id="bandwidth" required>
        <label>Harga</label><input id="hargaPaket" required>
        <button class="primary" type="submit">Simpan Paket</button>
      </form>
      <div class="card"><table id="paketTable"><thead><tr><th>Paket</th><th>Bandwidth</th><th>Harga</th><th>Aksi</th></tr></thead><tbody></tbody></table></div>
    </div>

    <!-- Billing -->
    <div id="billing" class="section" style="display:none;">
      <h2>Billing</h2>
      <button class="primary" onclick="generateBilling()">Generate Billing Sekarang</button>
      <div class="card"><table id="billingTable"><thead><tr><th>User</th><th>Paket</th><th>Harga</th><th>Prorata</th><th>Status</th></tr></thead><tbody></tbody></table></div>
    </div>

    <!-- Kas -->
    <div id="kas" class="section" style="display:none;">
      <h2>Kas</h2>
      <form id="kasForm">
        <input type="hidden" id="kasId">
        <label>Keterangan</label><input id="kasKet" required>
        <label>Jumlah</label><input id="kasJumlah" required>
        <button class="primary" type="submit">Simpan</button>
      </form>
      <div class="card"><table id="kasTable"><thead><tr><th>Keterangan</th><th>Jumlah</th><th>Aksi</th></tr></thead><tbody></tbody></table></div>
    </div>
  </div>

<script>
  const firebaseConfig={apiKey:"AIzaSyB-iBpZNC0YZBTAUzir7gJuU9kBQg82moc",authDomain:"dnt-network-7.firebaseapp.com",projectId:"dnt-network-7"};
  firebase.initializeApp(firebaseConfig);
  const db=firebase.firestore();

  document.getElementById("toggleBtn").onclick=()=>{document.getElementById("sidebar").classList.toggle("active");};
  function showSection(id,el){document.querySelectorAll('.section').forEach(s=>s.style.display="none");document.getElementById(id).style.display="block";document.querySelectorAll('.sidebar a').forEach(a=>a.classList.remove("active"));if(el)el.classList.add("active");}
  function logout(){alert("Logout sukses!");}

  // CRUD Helper
  function renderTable(collection,tableId,fields){db.collection(collection).onSnapshot(snap=>{let tbody=document.querySelector(`#${tableId} tbody`);tbody.innerHTML="";snap.forEach(doc=>{let d=doc.data();let tr=document.createElement("tr");fields.forEach(f=>{let td=document.createElement("td");td.textContent=d[f]||"";tr.appendChild(td);});let td=document.createElement("td");td.innerHTML=`<button onclick="editItem('${collection}','${doc.id}')">Edit</button><button onclick="deleteItem('${collection}','${doc.id}')">Hapus</button>`;tr.appendChild(td);tbody.appendChild(tr);});});}
  function saveForm(e,collection,idField,fields){e.preventDefault();const id=document.getElementById(idField).value;let data={};fields.forEach(f=>data[f]=document.getElementById(f).value);if(id){db.collection(collection).doc(id).update(data);}else{db.collection(collection).add(data);}e.target.reset();document.getElementById(idField).value="";}
  function editItem(c,id){db.collection(c).doc(id).get().then(doc=>{if(doc.exists){let d=doc.data();Object.keys(d).forEach(k=>{if(document.getElementById(k))document.getElementById(k).value=d[k];});if(document.getElementById(c+"Id"))document.getElementById(c+"Id").value=id;}});}
  function deleteItem(c,id){if(confirm("Yakin hapus?"))db.collection(c).doc(id).delete();}

  // User
  document.getElementById("userForm").onsubmit=(e)=>saveForm(e,"user","userId",["userName","planName","statusBayar"]);
  renderTable("user","userTable",["userName","planName","statusBayar"]);

  // Paket
  document.getElementById("paketForm").onsubmit=(e)=>saveForm(e,"paket","paketId",["namaPaket","bandwidth","hargaPaket"]);
  renderTable("paket","paketTable",["namaPaket","bandwidth","hargaPaket"]);

  // Kas
  document.getElementById("kasForm").onsubmit=(e)=>saveForm(e,"kas","kasId",["kasKet","kasJumlah"]);
  renderTable("kas","kasTable",["kasKet","kasJumlah"]);

  // Billing otomatis
  function generateBilling(){
    const now=new Date();
    const periode=`${now.getMonth()+1}-${now.getFullYear()}`;
    db.collection("billing").where("periode","==",periode).get().then(snap=>{
      if(!snap.empty){alert("Billing bulan ini sudah digenerate!");return;}
      db.collection("user").get().then(users=>{
        users.forEach(u=>{
          let user=u.data();
          db.collection("paket").where("namaPaket","==",user.planName).get().then(p=>{
            if(!p.empty){
              let harga=p.docs[0].data().hargaPaket;
              db.collection("billing").add({billingUser:user.userName,billingPaket:user.planName,billingHarga:harga,billingProrata:"-",statusBayar:"Belum",periode:periode});
            }
          });
        });
      });
    });
  }
  renderTable("billing","billingTable",["billingUser","billingPaket","billingHarga","billingProrata","statusBayar"]);

  // Dashboard counters
  db.collection("user").onSnapshot(snap=>{document.getElementById("totalUser").textContent=snap.size;});
  db.collection("kas").onSnapshot(snap=>{let saldo=0;snap.forEach(doc=>{saldo+=parseFloat(doc.data().kasJumlah||0);});document.getElementById("saldoKas").textContent=saldo;});
</script>
</body>
</html>
