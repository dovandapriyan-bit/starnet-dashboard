<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Starnet Manager Dashboard Full CRUD</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB-iBpZNC0YZBTAUzir7gJuU9kBQg82moc",
    authDomain: "dnt-network-7.firebaseapp.com",
    projectId: "dnt-network-7",
    storageBucket: "dnt-network-7.firebasestorage.app",
    messagingSenderId: "761179668371",
    appId: "1:761179668371:web:7d1468d0298041d4783266",
    measurementId: "G-CD3EQ350R4"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.db = db;
  window.collection = collection;
  window.addDoc = addDoc;
  window.updateDoc = updateDoc;
  window.deleteDoc = deleteDoc;
  window.doc = doc;
  window.onSnapshot = onSnapshot;
</script>
<style>
  body { font-family: 'Inter', sans-serif; }
  .sidebar { transition: all 0.3s; }
  .sidebar.minimized { width: 60px; }
  .sidebar.minimized .menu-text { display: none; }
  .table-container { max-height: 500px; overflow-y: auto; }
</style>
</head>
<body class="bg-gray-100">

<div class="flex h-screen">
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar bg-gray-800 text-white w-64 p-4 flex flex-col">
    <div class="flex items-center justify-between mb-6">
      <span class="font-bold text-xl">üí´ Starnet</span>
      <button id="toggleSidebar" class="text-gray-400 hover:text-white">‚ò∞</button>
    </div>
    <nav class="flex flex-col gap-2">
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="dashboard"><span>üìä</span><span class="menu-text">Dashboard</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="pelanggan"><span>üë§</span><span class="menu-text">Pelanggan</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="paket"><span>üì¶</span><span class="menu-text">Paket</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="billing"><span>üí∞</span><span class="menu-text">Billing</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="kas"><span>üßæ</span><span class="menu-text">Kas</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="gangguan"><span>‚ö†Ô∏è</span><span class="menu-text">Gangguan</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="teknisi"><span>üõ†Ô∏è</span><span class="menu-text">Teknisi</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="odp"><span>üîå</span><span class="menu-text">ODP</span></button>
      <button class="menu-item flex items-center gap-2 p-2 hover:bg-gray-700" data-target="pengaturan"><span>‚öôÔ∏è</span><span class="menu-text">Pengaturan</span></button>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="flex-1 p-6 overflow-auto">
    <!-- Dashboard -->
    <div id="dashboard" class="content-section">
      <h2 class="text-2xl font-bold mb-4">Dashboard</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white p-4 rounded shadow">Total Pelanggan: <span id="totalPelanggan">0</span></div>
        <div class="bg-white p-4 rounded shadow">Total Billing: <span id="totalBilling">0</span></div>
        <div class="bg-white p-4 rounded shadow">Saldo Kas: <span id="saldoKas">0</span></div>
      </div>
    </div>

    <!-- Semua menu -->
    <div id="pelanggan" class="content-section hidden">
      <h2 class="text-xl font-bold mb-2">Pelanggan</h2>
      <button onclick="showAddForm('pelanggan')" class="mb-2 px-4 py-2 bg-green-500 text-white rounded">Tambah Pelanggan</button>
      <div class="table-container overflow-auto">
        <table class="min-w-full bg-white" id="pelangganTable">
          <thead class="bg-gray-200"><tr><th>Nama</th><th>NIK</th><th>HP</th><th>Alamat</th><th>Paket</th><th>ODP</th><th>Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Paket -->
    <div id="paket" class="content-section hidden">
      <h2 class="text-xl font-bold mb-2">Paket</h2>
      <button onclick="showAddForm('paket')" class="mb-2 px-4 py-2 bg-green-500 text-white rounded">Tambah Paket</button>
      <div class="table-container overflow-auto">
        <table class="min-w-full bg-white" id="paketTable">
          <thead class="bg-gray-200"><tr><th>Nama Paket</th><th>Harga</th><th>Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Billing -->
    <div id="billing" class="content-section hidden">
      <h2 class="text-xl font-bold mb-2">Billing</h2>
      <button onclick="showAddForm('billing')" class="mb-2 px-4 py-2 bg-green-500 text-white rounded">Tambah Billing</button>
      <div class="table-container overflow-auto">
        <table class="min-w-full bg-white" id="billingTable">
          <thead class="bg-gray-200"><tr><th>Pelanggan</th><th>Periode</th><th>Jumlah</th><th>Status</th><th>Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Kas -->
    <div id="kas" class="content-section hidden">
      <h2 class="text-xl font-bold mb-2">Kas</h2>
      <button onclick="showAddForm('kas')" class="mb-2 px-4 py-2 bg-green-500 text-white rounded">Tambah Kas</button>
      <div class="table-container overflow-auto">
        <table class="min-w-full bg-white" id="kasTable">
          <thead class="bg-gray-200"><tr><th>Keterangan</th><th>Jumlah</th><th>Tanggal</th><th>Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Gangguan -->
    <div id="gangguan" class="content-section hidden">
      <h2 class="text-xl font-bold mb-2">Gangguan</h2>
      <button onclick="showAddForm('gangguan')" class="mb-2 px-4 py-2 bg-green-500 text-white rounded">Tambah Gangguan</button>
      <div class="table-container overflow-auto">
        <table class="min-w-full bg-white" id="gangguanTable">
          <thead class="bg-gray-200"><tr><th>Deskripsi</th><th>Pelanggan</th><th>TTR</th><th>Status</th><th>Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Teknisi -->
    <div id="teknisi" class="content-section hidden">
      <h2 class="text-xl font-bold mb-2">Teknisi</h2>
      <button onclick="showAddForm('teknisi')" class="mb-2 px-4 py-2 bg-green-500 text-white rounded">Tambah Teknisi</button>
      <div class="table-container overflow-auto">
        <table class="min-w-full bg-white" id="teknisiTable">
          <thead class="bg-gray-200"><tr><th>Nama</th><th>HP</th><th>Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- ODP -->
    <div id="odp" class="content-section hidden">
      <h2 class="text-xl font-bold mb-2">ODP</h2>
      <button onclick="showAddForm('odp')" class="mb-2 px-4 py-2 bg-green-500 text-white rounded">Tambah ODP</button>
      <div class="table-container overflow-auto">
        <table class="min-w-full bg-white" id="odpTable">
          <thead class="bg-gray-200"><tr><th>Nama ODP</th><th>Alamat</th><th>Port</th><th>Aksi</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<!-- Modal -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
  <div class="bg-white p-6 rounded w-96">
    <h3 id="modalTitle" class="text-xl font-bold mb-4">Tambah Data</h3>
    <div id="modalContent"></div>
    <div class="mt-4 flex justify-end gap-2">
      <button onclick="closeModal()" class="px-4 py-2 rounded bg-gray-300">Batal</button>
      <button id="modalSaveBtn" class="px-4 py-2 rounded bg-blue-500 text-white">Simpan</button>
    </div>
  </div>
</div>

<script>
  const sidebar = document.getElementById('sidebar');
  document.getElementById('toggleSidebar').onclick = () => sidebar.classList.toggle('minimized');

  const menuItems = document.querySelectorAll('.menu-item');
  const contentSections = document.querySelectorAll('.content-section');
  menuItems.forEach(item => item.onclick = () => {
    contentSections.forEach(sec => sec.classList.add('hidden'));
    document.getElementById(item.dataset.target).classList.remove('hidden');
  });

  const modal = document.getElementById('modal');
  const modalContent = document.getElementById('modalContent');
  const modalTitle = document.getElementById('modalTitle');
  const modalSaveBtn = document.getElementById('modalSaveBtn');
  let currentCollection = '';
  let editId = null;

  function showAddForm(collectionName, data=null, id=null) {
    currentCollection = collectionName;
    editId = id;
    modalTitle.innerText = (data?'Edit ':'Tambah ') + collectionName;
    modalContent.innerHTML = '';
    let fields='';
    switch(collectionName){
      case 'pelanggan':
        fields=`<input placeholder="Nama" id="fieldNama" class="border p-2 w-full mb-2" value="${data?.nama||''}">
                <input placeholder="NIK" id="fieldNIK" class="border p-2 w-full mb-2" value="${data?.nik||''}">
                <input placeholder="HP" id="fieldHP" class="border p-2 w-full mb-2" value="${data?.hp||''}">
                <input placeholder="Alamat" id="fieldAlamat" class="border p-2 w-full mb-2" value="${data?.alamat||''}">
                <input placeholder="Paket" id="fieldPaket" class="border p-2 w-full mb-2" value="${data?.paket||''}">
                <input placeholder="ODP" id="fieldODP" class="border p-2 w-full mb-2" value="${data?.odp||''}">`;
        break;
      case 'paket':
        fields=`<input placeholder="Nama Paket" id="fieldNama" class="border p-2 w-full mb-2" value="${data?.nama||''}">
                <input placeholder="Harga" id="fieldHarga" class="border p-2 w-full mb-2" value="${data?.harga||''}">`;
        break;
      case 'billing':
        fields=`<input placeholder="Pelanggan" id="fieldPelanggan" class="border p-2 w-full mb-2" value="${data?.pelanggan||''}">
                <input placeholder="Periode" id="fieldPeriode" class="border p-2 w-full mb-2" value="${data?.periode||''}">
                <input placeholder="Jumlah" id="fieldJumlah" class="border p-2 w-full mb-2" value="${data?.jumlah||''}">
                <input placeholder="Status" id="fieldStatus" class="border p-2 w-full mb-2" value="${data?.status||''}">`;
        break;
      case 'kas':
        fields=`<input placeholder="Keterangan" id="fieldKeterangan" class="border p-2 w-full mb-2" value="${data?.keterangan||''}">
                <input placeholder="Jumlah" id="fieldJumlah" class="border p-2 w-full mb-2" value="${data?.jumlah||''}">
                <input placeholder="Tanggal" id="fieldTanggal" class="border p-2 w-full mb-2" value="${data?.tanggal||''}">`;
        break;
      case 'gangguan':
        fields=`<input placeholder="Deskripsi" id="fieldDeskripsi" class="border p-2 w-full mb-2" value="${data?.deskripsi||''}">
                <input placeholder="Pelanggan" id="fieldPelanggan" class="border p-2 w-full mb-2" value="${data?.pelanggan||''}">
                <input placeholder="TTR" id="fieldTTR" class="border p-2 w-full mb-2" value="${data?.ttr||''}">
                <input placeholder="Status" id="fieldStatus" class="border p-2 w-full mb-2" value="${data?.status||''}">`;
        break;
      case 'teknisi':
        fields=`<input placeholder="Nama" id="fieldNama" class="border p-2 w-full mb-2" value="${data?.nama||''}">
                <input placeholder="HP" id="fieldHP" class="border p-2 w-full mb-2" value="${data?.hp||''}">`;
        break;
      case 'odp':
        fields=`<input placeholder="Nama ODP" id="fieldNama" class="border p-2 w-full mb-2" value="${data?.nama||''}">
                <input placeholder="Alamat" id="fieldAlamat" class="border p-2 w-full mb-2" value="${data?.alamat||''}">
                <input placeholder="Port" id="fieldPort" class="border p-2 w-full mb-2" value="${data?.port||''}">`;
        break;
    }
    modalContent.innerHTML = fields;
    modal.classList.remove('hidden');
  }

  function closeModal() { modal.classList.add('hidden'); }

  modalSaveBtn.onclick = async () => {
    try {
      const db = window.db;
      const colRef = collection(db,currentCollection);
      let obj={};
      switch(currentCollection){
        case 'pelanggan':
          obj={nama: document.getElementById('fieldNama').value, nik: document.getElementById('fieldNIK').value,
              hp: document.getElementById('fieldHP').value, alamat: document.getElementById('fieldAlamat').value,
              paket: document.getElementById('fieldPaket').value, odp: document.getElementById('fieldODP').value};
          break;
        case 'paket':
          obj={nama: document.getElementById('fieldNama').value, harga: document.getElementById('fieldHarga').value};
          break;
        case 'billing':
          obj={pelanggan: document.getElementById('fieldPelanggan').value, periode: document.getElementById('fieldPeriode').value,
               jumlah: document.getElementById('fieldJumlah').value, status: document.getElementById('fieldStatus').value};
          break;
        case 'kas':
          obj={keterangan: document.getElementById('fieldKeterangan').value, jumlah: document.getElementById('fieldJumlah').value,
               tanggal: document.getElementById('fieldTanggal').value};
          break;
        case 'gangguan':
          obj={deskripsi: document.getElementById('fieldDeskripsi').value, pelanggan: document.getElementById('fieldPelanggan').value,
               ttr: document.getElementById('fieldTTR').value, status: document.getElementById('fieldStatus').value};
          break;
        case 'teknisi':
          obj={nama: document.getElementById('fieldNama').value, hp: document.getElementById('fieldHP').value};
          break;
        case 'odp':
          obj={nama: document.getElementById('fieldNama').value, alamat: document.getElementById('fieldAlamat').value,
               port: document.getElementById('fieldPort').value};
          break;
      }
      if(editId){await updateDoc(doc(db,currentCollection,editId),obj); editId=null;}
      else{await addDoc(colRef,obj);}
      closeModal();
    } catch(err){alert(err);}
  };

  function renderCollection(colName, tableId){
    const tbl=document.getElementById(tableId).querySelector('tbody');
    onSnapshot(collection(db,colName),(snapshot)=>{
      tbl.innerHTML='';
      snapshot.docs.forEach(docu=>{
        const data=docu.data();
        let row=document.createElement('tr');
        switch(colName){
          case 'pelanggan':
            row.innerHTML=`<td class="px-4 py-2">${data.nama}</td><td class="px-4 py-2">${data.nik}</td><td class="px-4 py-2">${data.hp}</td><td class="px-4 py-2">${data.alamat}</td><td class="px-4 py-2">${data.paket}</td><td class="px-4 py-2">${data.odp}</td><td class="px-4 py-2 flex gap-2"><button onclick='showAddForm("pelanggan",${JSON.stringify(data)},"${docu.id}")' class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button><button onclick='deleteDoc(doc(db,"pelanggan","${docu.id}"))' class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button></td>`;
            break;
          case 'paket':
            row.innerHTML=`<td class="px-4 py-2">${data.nama}</td><td class="px-4 py-2">${data.harga}</td><td class="px-4 py-2 flex gap-2"><button onclick='showAddForm("paket",${JSON.stringify(data)},"${docu.id}")' class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button><button onclick='deleteDoc(doc(db,"paket","${docu.id}"))' class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button></td>`;
            break;
          case 'billing':
            row.innerHTML=`<td>${data.pelanggan}</td><td>${data.periode}</td><td>${data.jumlah}</td><td>${data.status}</td><td class="flex gap-2"><button onclick='showAddForm("billing",${JSON.stringify(data)},"${docu.id}")' class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button><button onclick='deleteDoc(doc(db,"billing","${docu.id}"))' class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button></td>`;
            break;
          case 'kas':
            row.innerHTML=`<td>${data.keterangan}</td><td>${data.jumlah}</td><td>${data.tanggal}</td><td class="flex gap-2"><button onclick='showAddForm("kas",${JSON.stringify(data)},"${docu.id}")' class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button><button onclick='deleteDoc(doc(db,"kas","${docu.id}"))' class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button></td>`;
            break;
          case 'gangguan':
            row.innerHTML=`<td>${data.deskripsi}</td><td>${data.pelanggan}</td><td>${data.ttr}</td><td>${data.status}</td><td class="flex gap-2"><button onclick='showAddForm("gangguan",${JSON.stringify(data)},"${docu.id}")' class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button><button onclick='deleteDoc(doc(db,"gangguan","${docu.id}"))' class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button></td>`;
            break;
          case 'teknisi':
            row.innerHTML=`<td>${data.nama}</td><td>${data.hp}</td><td class="flex gap-2"><button onclick='showAddForm("teknisi",${JSON.stringify(data)},"${docu.id}")' class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button><button onclick='deleteDoc(doc(db,"teknisi","${docu.id}"))' class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button></td>`;
            break;
          case 'odp':
            row.innerHTML=`<td>${data.nama}</td><td>${data.alamat}</td><td>${data.port}</td><td class="flex gap-2"><button onclick='showAddForm("odp",${JSON.stringify(data)},"${docu.id}")' class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button><button onclick='deleteDoc(doc(db,"odp","${docu.id}"))' class="bg-red-500 text-white px-2 py-1 rounded">Hapus</button></td>`;
            break;
        }
        tbl.appendChild(row);
      });
    });
  }

  renderCollection('pelanggan','pelangganTable');
  renderCollection('paket','paketTable');
  renderCollection('billing','billingTable');
  renderCollection('kas','kasTable');
  renderCollection('gangguan','gangguanTable');
  renderCollection('teknisi','teknisiTable');
  renderCollection('odp','odpTable');
</script>
</body>
</html>
