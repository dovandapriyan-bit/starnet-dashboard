<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ISP Manager Super Final + WA Simulasi</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family:'Segoe UI',sans-serif;margin:0;background:#f0f2f5; }
h1,h2 { color:#1f3b6f; }
button { cursor:pointer;border:none;border-radius:6px;padding:6px 12px;transition:0.3s; }
button:hover { opacity:0.85; }
input, select { border-radius:6px;border:1px solid #ccc;padding:8px;outline:none;transition:0.3s; }
input:focus, select:focus { border-color:#1f3b6f; }
#loginPage { display:flex; justify-content:center; align-items:center; height:100vh; background:linear-gradient(135deg,#1f3b6f,#4b6cb7); }
#loginBox { background:white;padding:40px;border-radius:15px;box-shadow:0 10px 25px rgba(0,0,0,0.2);width:360px;text-align:center; }
#loginBox h2 { margin-bottom:25px; }
#loginBox input { width:100%; margin-bottom:15px; font-size:14px; }
#loginBox button { width:100%; background:#1f3b6f; color:white; font-weight:bold; margin-top:5px; }
#loginBox p.info { font-size:12px;color:#666;margin-top:20px; }
#appPage { display:none; display:flex; width:100%; }
#sidebar { width:220px; background:#1f3b6f; color:white; min-height:100vh; transition:0.3s; }
#sidebar.collapsed { width:60px; }
#sidebar h2 { text-align:center; padding:15px 0; border-bottom:1px solid rgba(255,255,255,0.2); }
#sidebar ul { list-style:none; padding:0; margin:0; }
#sidebar ul li { padding:12px 20px; cursor:pointer; transition:0.3s; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
#sidebar ul li:hover { background:#4b6cb7; }
#sidebar ul li i { margin-right:10px; }
#mainContent { flex:1; padding:20px; overflow:auto; }
.hidden { display:none; }
table { border-collapse:collapse; width:100%; margin-top:10px; background:white; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition:0.3s; }
th, td { border:1px solid #ddd; padding:10px; font-size:14px; text-align:center; transition:0.3s; }
th { background:#1f3b6f; color:white; }
tr:hover { background: #e3f2fd; }
tr td button { transition: transform 0.2s; }
tr td button:hover { transform: translateY(-2px); }
.btn-primary { background:#1f3b6f; color:white; }
.btn-success { background:#28a745; color:white; }
.btn-warning { background:#ffc107; color:white; }
.btn-danger { background:#dc3545; color:white; }
form { margin-bottom:15px; display:flex; flex-wrap:wrap; gap:10px; }
form input, form select { flex:1; min-width:100px; }
#topBar { display:flex; justify-content:space-between; align-items:center; background:#fff; padding:10px 20px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-bottom:10px; border-radius:6px; }
#topBar span { font-weight:bold; }
#hamburger { font-size:20px; cursor:pointer; margin-right:10px; }
</style>
</head>
<body>

<div id="loginPage">
  <div id="loginBox">
    <h2>Login Karyawan / Pelanggan</h2>
    <input id="nik" placeholder="NIK / ID Pelanggan">
    <input id="password" type="password" placeholder="Password">
    <button onclick="loginNIK()">Login</button>
    <p id="loginMsg" style="color:red;margin-top:10px;font-size:13px;"></p>
    <p class="info">by Dnt Grup - StarnetğŸ’«</p>
    <p class="info">Email: dnt.network.lmj@gmail.com</p>
  </div>
</div>

<div id="appPage">
  <div id="sidebar">
    <h2>ISP ğŸ’«</h2>
    <ul>
      <li onclick="showPage('dashboard')">ğŸ“Š Dashboard</li>
      <li onclick="showPage('gangguan')">âš ï¸ Gangguan</li>
      <li onclick="showPage('pasangBaru')">ğŸ†• Pasang Baru</li>
      <li onclick="showPage('pelanggan')">ğŸ‘¥ Pelanggan</li>
      <li onclick="showPage('billing')">ğŸ’³ Billing</li>
      <li onclick="showPage('kas')">ğŸ’° Kas</li>
      <li onclick="showPage('odp')">ğŸ–§ ODP / Mikrotik</li>
      <li onclick="showPage('material')">ğŸ“¦ Material</li>
      <li onclick="showPage('paket')">ğŸ“¦ Paket / Tarif</li>
      <li onclick="showPage('karyawan')">ğŸ‘” Karyawan</li>
      <li onclick="showPage('webhook')">âš™ï¸ Webhook</li>
      <li onclick="showPage('history')">ğŸ—‚ï¸ Arsip / History</li>
      <li onclick="showPage('portal')">ğŸŒ Portal Pelanggan</li>
      <li onclick="logout()">ğŸšª Logout</li>
    </ul>
  </div>

  <div id="mainContent">
    <div id="topBar">
      <div><span id="hamburger" onclick="toggleSidebar()">â˜°</span>Halo, <span id="userName"></span> (<span id="userRole"></span>)</div>
      <button onclick="logout()" class="btn-warning">Logout</button>
    </div>

    <div id="dashboardPage"><h2>Dashboard</h2><canvas id="chartDashboard" height="100"></canvas></div>

    <div id="gangguanPage" class="hidden">
      <h2>Gangguan / Tiket</h2>
      <table id="tblGangguan"><thead><tr><th>Kode</th><th>Pelanggan</th><th>Masalah</th><th>Status</th><th>TTR</th><th>Aksi</th></tr></thead><tbody></tbody></table>
      <button onclick="generateDummyGangguan()" class="btn-primary">Generate Dummy Gangguan</button>
    </div>

    <div id="pasangBaruPage" class="hidden">
      <h2>Pasang Baru</h2>
      <form id="formPasang">
        <input id="nama" placeholder="Nama" required>
        <input id="noHp" placeholder="No HP" required>
        <input id="alamat" placeholder="Alamat" required>
        <input id="paket" placeholder="Paket" required>
        <input id="snOnt" placeholder="SN ONT">
        <input id="odpPasang" placeholder="ODP">
        <select id="statusPasang"><option>Menunggu</option><option>Survey</option><option>Instalasi</option><option>Active</option></select>
        <button type="submit" class="btn-primary">Daftar</button>
      </form>
      <table id="tblPasang"><thead><tr><th>No Internet</th><th>Nama</th><th>No HP</th><th>Alamat</th><th>Paket</th><th>SN ONT</th><th>ODP</th><th>Status</th><th>Aksi</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- Sisanya tetap sama, karyawan, material, paket, webhook, portal, history, dsb -->

  </div>
</div>

<script>
// FIREBASE
const firebaseConfig = {apiKey:"AIzaSyB-iBpZNC0YZBTAUzir7gJuU9kBQg82moc",authDomain:"dnt-network-7.firebaseapp.com",projectId:"dnt-network-7",storageBucket:"dnt-network-7.appspot.com",messagingSenderId:"761179668371",appId:"1:761179668371:web:7d1468d0298041d4783266",measurementId:"G-CD3EQ350R4"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
let currentUser=null;

// LOGIN
async function loginNIK(){const nik=document.getElementById('nik').value.toLowerCase(); const pass=document.getElementById('password').value; const userDoc=await db.collection('users').doc(nik).get(); if(!userDoc.exists){document.getElementById('loginMsg').innerText="ID tidak ditemukan";return;} const data=userDoc.data(); if(data.password!==pass){document.getElementById('loginMsg').innerText="Password salah";return;} currentUser={nik:nik,...data}; document.getElementById('loginPage').style.display='none'; document.getElementById('appPage').style.display='flex'; document.getElementById('userName').innerText=data.nama; document.getElementById('userRole').innerText=data.role||'-'; showPage('dashboard');}

// LOGOUT
function logout(){currentUser=null; document.getElementById('loginPage').style.display='flex'; document.getElementById('appPage').style.display='none';}

// SIDEBAR
function showPage(page){['dashboard','gangguan','pasangBaru','pelanggan','billing','kas','odp','material','paket','karyawan','webhook','history','portal'].forEach(p=>{document.getElementById(p+'Page')?.classList.add('hidden');}); document.getElementById(page+'Page')?.classList.remove('hidden');}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('collapsed');}

// PASANG BARU AUTO
let nextNoInternet=1906140000;
document.getElementById('formPasang')?.addEventListener('submit',async e=>{e.preventDefault(); const nama=document.getElementById('nama').value; const noHp=document.getElementById('noHp').value; const alamat=document.getElementById('alamat').value; const paket=document.getElementById('paket').value; const snOnt=document.getElementById('snOnt').value; const odp=document.getElementById('odpPasang').value; const status=document.getElementById('statusPasang').value; const noInternet=''+nextNoInternet; nextNoInternet++; await db.collection('pasangBaru').doc(noInternet).set({nama,noHp,alamat,paket,snOnt,odp,status}); loadPasangBaru(); e.target.reset();});
async function loadPasangBaru(){const snap=await db.collection('pasangBaru').get(); const tb=document.querySelector('#tblPasang tbody'); tb.innerHTML=''; snap.forEach(doc=>{const d=doc.data(); const tr=document.createElement('tr'); tr.innerHTML=`<td>${doc.id}</td><td>${d.nama}</td><td>${d.noHp}</td><td>${d.alamat}</td><td>${d.paket}</td><td>${d.snOnt}</td><td>${d.odp}</td><td>${d.status}</td><td><button onclick="hapusPasang('${doc.id}')" class="btn-danger">Hapus</button></td>`; tb.appendChild(tr);});}
async function hapusPasang(noInternet){if(!confirm("Hapus data pasang baru?")) return; await db.collection('pasangBaru').doc(noInternet).delete(); loadPasangBaru();}

// GANGGUAN + SIMULASI WA TEKNISI
let nextTiket=1;
function generateDummyGangguan(){const kode='TC'+('0000'+nextTiket).slice(-5); nextTiket++; const pelanggan='Pelanggan'+nextTiket; const masalah='Internet lemot'; const status='Menunggu'; const ttr='00:30'; db.collection('gangguan').doc(kode).set({pelanggan,masalah,status,ttr}); alert('Tiket gangguan dibuat: '+kode+'\nSimulasi WA: Admin kirim notifikasi ke teknisi'); loadGangguan();}
async function loadGangguan(){const snap=await db.collection('gangguan').get(); const tb=document.querySelector('#tblGangguan tbody'); tb.innerHTML=''; snap.forEach(doc=>{const d=doc.data(); const tr=document.createElement('tr'); tr.innerHTML=`<td>${doc.id}</td><td>${d.pelanggan}</td><td>${d.masalah}</td><td>${d.status}</td><td>${d.ttr}</td><td>${d.status==='Menunggu'?`<button onclick="verifikasiTeknisi('${doc.id}')" class="btn-success">Verifikasi</button>`:'<button disabled class="btn-primary">Done</button>'}</td>`; tb.appendChild(tr);});}
async function verifikasiTeknisi(kode){await db.collection('gangguan').doc(kode).update({status:'Progres'}); alert('Teknisi verifikasi progres\nSimulasi WA: Update status ke admin'); await db.collection('gangguan').doc(kode).update({status:'Material Dicek'}); alert('Teknisi cek material\nStok material dikurangi otomatis'); loadGangguan();}

// DASHBOARD
let chartDashboard=null;
function initDashboard(){const ctx=document.getElementById('chartDashboard').getContext('2d'); chartDashboard=new Chart(ctx,{type:'bar',data:{labels:['Jan','Feb','Mar','Apr','Mei'],datasets:[{label:'Pelanggan Baru',data:[12,19,3,5,2],backgroundColor:'#1f3b6f'}]},options:{responsive:true}});}
window.onload=()=>{initDashboard();}
</script>

</body>
</html>
